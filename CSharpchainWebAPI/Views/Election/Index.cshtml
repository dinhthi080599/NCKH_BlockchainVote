
@{
}
<div class="container-fluid">
    <div class="row mb-2">
        <div class="col-md-8">
            <h2>@ViewBag.dotBauCu.sTenDot</h2>
        </div>
        <div class="col-md-4 text-right">
            <button type="button" class="btn btn-info" data-toggle="modal" data-target="#myModal">
                Tham gia bỏ phiếu
            </button>
            <button type="button" class="btn btn-success" data-toggle="modal" data-target="#newElectorModal" data-backdrop="static" data-keyboard="false">
                Thêm cử tri
            </button>
        </div>
        <div class="col-md-8">
            <p>
                <i class="fa fa-clock-o" aria-hidden="true"></i>
                Thời gian bỏ phiếu: @ViewBag.dotBauCu.dThoiGianBD đến @ViewBag.dotBauCu.dThoiGianKT

            </p>
        </div>
        <div class="col-md-4 text-right">
            <p class="text ">
                Trạng thái:
                <span class="text-@ViewBag.ES.icon">
                    @ViewBag.ES.tenTrangThaiDotBauCU
                </span>
            </p>
        </div>
        <div class="col-md-12">
            <div class="card card-primary card-outline">
                <div class="card-body p-0">
                    <div class="mailbox-read-message">
                        @Html.Raw(ViewBag.dotBauCu.sNoiDung)
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="text-center col-sm-12 row">
        <h3 class="col-sm-12">Danh sách cử tri</h3>
        @foreach (var elector in ViewBag.ElectorList)
        {
            <div class="col-sm-4">
                <div class="small-box bg-success">
                    <div class="inner">
                        <h3>@elector.sHoten</h3>
                        <p>@elector.bGioitinh</p>
                        <p class="cutri_@elector.ma_cutri hide">@elector.ma_cutri</p>
                    </div>
                    <div class="icon">
                        <i class="fas fa-user"></i>
                    </div>
                    <a onclick="showDetail(@elector.ma_cutri)" class="small-box-footer" data-toggle="modal" data-target="#electorModal">
                        Thêm thông tin
                        <i class="fas fa-arrow-circle-right"></i>
                    </a>
                </div>
            </div>
        }
    </div>
</div>

<!-- The Modal -->
<div class="modal" id="myModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Phiếu bầu</h4>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                Đây là cái phiếu
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" data-dismiss="modal">Xác nhận</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>
<!-- elector detail-->
<div class="modal" id="electorModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Thông tin cử tri</h4>
            </div>
            <div class="modal-body row">
                <div class="col-sm-12 row">
                    <p class="col-sm-6"> Họ tên cử tri</p>
                    <p class="col-sm-6" id="ElectorModalName"></p>
                </div>
                <div class="col-sm-12 row">
                    <p class="col-sm-6"> Ngày sinh</p>
                    <p class="col-sm-6" id="ElectorModalNs"></p>
                </div>
                <div class="col-sm-12 row">
                    <p class="col-sm-6"> Địa chỉ</p>
                    <p class="col-sm-6" id="ElectorModalAddress"></p>
                </div>
                <div class="col-sm-12 row">
                    <p class="col-sm-6"> Email</p>
                    <p class="col-sm-6" id="ElectorModalEmail"></p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-success" data-dismiss="modal">Xác nhận</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<!-- add elector-->
<div class="modal" id="newElectorModal">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Thêm mới cử tri</h4>
            </div>
            <div class="modal-body row">
                <div class="col-sm-12 form-group row">
                    <label class="col-sm-2 col-form-label font-weight-normal">Họ tên cử tri</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="newElectorName" placeholder="Nguyễn Văn XHF">
                    </div>
                </div>
                <div class="col-sm-12 form-group row">
                    <label class="col-sm-2 col-form-label font-weight-normal">Giới tính</label>
                    <div class="col-sm-10 input-group">
                        <select style="-webkit-appearance:none;" class="custom-select" id="newElectorGender">
                            <option value="Nam">Nam</option>
                            <option value="Nu">Nu</option>
                        </select>
                    </div>
                </div>
                <div class="col-sm-12 form-group row">
                    <label class="col-sm-2 col-form-label font-weight-normal">Ngày sinh</label>
                    <div class="col-sm-10 input-group">
                        <input class="form-control" id="newElectorNs" name="newElectorNs" type="text" onkeypress="changeDate()" />
                        <div class="input-group-append">
                            <span class="input-group-text">
                                <i class="fas fa-calendar-week"></i>
                            </span>
                        </div>
                    </div>
                </div>
                <div class="col-sm-12 form-group row">
                    <label class="col-sm-2 col-form-label font-weight-normal">Địa chỉ</label>
                    <div class="col-sm-10">
                        <input type="text" class="form-control" id="newElectorAddress">
                    </div>
                </div>
                <div class="col-sm-12 form-group row">
                    <label class="col-sm-2 col-form-label font-weight-normal">Email</label>
                    <div class="col-sm-10">
                        <input type="email" class="form-control" id="newElectorEmail">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="addElector" type="button" class="btn btn-success">Xác nhận</button>
                <button type="button" class="btn btn-danger" data-dismiss="modal">Đóng</button>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#newElectorNs').datepicker({
            uiLibrary: 'bootstrap'
        });
        $("#addElector").on("click", function () {
            let x = window.location.pathname.split('/')[2];
            let name = $("#newElectorName").val();
            let ns = $("#newElectorNs").val();
            let address = $("#newElectorAddress").val();
            let email = $("#newElectorEmail").val();
            let gender = $("#newElectorGenderl").val();
            $.ajax({
                url: window.location.href + "/createElector",
                type: "POST",
                data: { dbcId: x, sHoten: name, dNgaysinh: ns, sDiachi: address, sEmail: email, bGioitinh: gender }
            }).then(function (result) {
                if (result) {
                    alert("Thành công");
                    $('#newElectorModal').modal('hide');
                    location.reload();
                } else {
                    alert("Thất bại");
                }
            });
        });
    });

    function changeDate() {
        setTimeout(() => {
            const value = $("#newElectorNs").val();
            if (value && value.length === 8) {
                if (value.indexOf("-") === -1 && value.indexOf("/") === -1) {
                    const returnDate = replaceDate(value);
                    // this.model[model] = returnDate;
                    if (returnDate && returnDate.length > 0) {
                        $("#newElectorNs").val(returnDate);
                        //const dateParts = returnDate.split("/");
                        //$("#newElectorNs").val(new Date(+dateParts[2], dateParts[1] - 1, +dateParts[0]));
                    }
                }
            }
        }, 200);
    }

    function showDetail(str) {
        let x = window.location.pathname.split('/')[2];
        $.ajax({
            url: window.location.href + "/getDetailElector",
            type: "POST",
            data: { selectedId: str, id: x },
            success: function (result) {
                $("#ElectorModalName").html(result.sHoten);
                $("#ElectorModalNs").html(result.dNgaysinh);
                $("#ElectorModalAddress").html(result.sDiachi);
                $("#ElectorModalEmail").html(result.sEmail);
            }
        });
    }

    function replaceDate(date) {
        date = date.toLowerCase();
        var patt = new RegExp(
            'q|w|e|r|t|y|u|i|o|p|a|s|d|f|g|h|j|k|l|z|x|c|v|b|n|m'
        );
        let returnDate = '';
        if (
            date.indexOf('-') === -1 &&
            date.indexOf('/') === -1 &&
            patt.test(date) === false
        ) {
            let day;
            let month;
            let year;
            if (date.length === 8) {
                day = date.substr(0, 2);
                month = date.substr(2, 2);
                year = date.substr(4, 4);
            } else if (date.length === 6) {
                day = date.substr(0, 2);
                month = date.substr(2, 2);
                year = date.substr(4, 2);
                if (parseInt(year, 0) < 50) {
                    year = parseInt('20' + year, 0);
                } else {
                    year = parseInt('19' + year, 0);
                }
            }

            if (parseInt(day, 0) > 31) {
                day = 30;
            }

            if (parseInt(month, 0) > 12) {
                month = 12;
            }
            if (parseInt(year, 0) > 3000) {
                year = 2020;
            }
            returnDate = day + '/' + month + '/' + year;
        } else {
            returnDate = date;
        }
        return returnDate;
    };
</script>